# ~/.tmux.conf
# =============================================================================
# GENERAL
# =============================================================================

# Set the default shell
set -g default-command /usr/bin/zsh

# Set the prefix to C-a
set -g prefix C-a

# Send prefix to a nested tmux session by doubling the prefix
bind C-a send-prefix

# Reduce escape time for faster responsiveness
set -s escape-time 0

# Increase scrollback buffer size
set -g history-limit 10000000

# Start window and pane numbering from 1
set -g base-index 1
set-window-option -g pane-base-index 1

# Renumber windows when one is removed
set -g renumber-windows on

# Allow automatic renaming of windows
set -g allow-rename on

# Don't detach tmux when killing a session
set -g detach-on-destroy off

# Focus events enabled for terminals that support them
set -g focus-events on

# =============================================================================
# KEY BINDINGS
# =============================================================================

# Reload config with Prefix + R
bind -r R source-file ~/.tmux.conf \; display "Reloaded!"

# Use Vi mode
set -g @shell_mode 'vi'

# Vim keybindings for copy mode
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi C-v send-keys -X rectangle-toggle
bind-key -T copy-mode-vi y send-keys -X copy-selection-and-cancel

# Paste from buffer
bind P paste-buffer

# Join panes
bind-key j choose-tree 'join-pane -h -s "%%"'
bind-key s choose-tree 'join-pane -h -t "%%"'

# Switch between previous and next windows
bind -n C-M-h previous-window
bind -n C-M-l next-window

# Switch between previous and next sessions
bind -n C-M-p switch-client -p
bind -n C-M-n switch-client -n
bind -n C-M-j display-popup -E "tms;"
bind -n C-M-k display-popup -E "tms switch;"

# Resize panes
bind H resize-pane -L 5
bind L resize-pane -R 5
bind J resize-pane -D 5
bind K resize-pane -U 5

# Resize panes with Ctrl (repeatable)
bind -r C-H resize-pane -L 5
bind -r C-L resize-pane -R 5
bind -r C-J resize-pane -D 5
bind -r C-K resize-pane -U 5

# Kill window with prompt
bind-key X command-prompt -p "kill window: " "kill-window -t '%%'"

# Create new window with current path
bind c new-window -c "#{pane_current_path}"

# bind -r p display-popup -E "tms;"
#
# bind -r e display-popup -E "tms switch;"
bind -r F display-popup -h 75% -w 75% -E "~/scripts/bin/tmux-search-home-directory-split.sh"
bind -r f display-popup -h 75% -w 75% -E "~/scripts/bin/tmux-search-home-directory.sh"
bind -r S display-popup -h 75% -w 75% -E "~/scripts/bin/tmux-switch-window-to-session.sh"
bind -r k display-popup -E "~/scripts/bin/tmux-delete-session.sh"
bind -r g new-window "/home/streicher/scripts/gemini/main.sh"

# =============================================================================
# APPEARANCE
# =============================================================================

# Improve colors
set -g default-terminal "xterm-256color"
set-option -ga terminal-overrides ",xterm-256color:Tc"

# Set status bar
set-option -g status-left-length 100
set-option -g status-left " #{session_name}  "

# Allow tmux to set the terminal title
set -g set-titles on

# Mouse mode off by default
set -g mouse off

# Toggle mouse mode with Prefix + m / Prefix + M
bind m set -g mouse on \; display 'Mouse: ON'
bind M set -g mouse off \; display 'Mouse: OFF'

# =============================================================================
# PLUGINS (TPM)
# =============================================================================

# List of plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'ofirgall/tmux-window-name'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'christoomey/vim-tmux-navigator'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin "nordtheme/tmux"

# tmux-continuum: auto-save every 60 minutes
set -g @continuum-save-interval '60'
set -g @continuum-restore 'on'

# tmux-resurrect: restore specific programs
set -g @resurrect-processes 'lazygit nvim'
set -g @resurrect-strategy-nvim 'session'
set -g @resurrect-save 'C-s'
set -g @resurrect-restore 'C-r'

# tmux-yank: copy to system clipboard
set -s set-clipboard on
set -g @yank_selection 'primary'

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'
